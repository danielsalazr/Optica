{% extends 'base.html' %} 
{% block container %}
{% load static %}
{% load humanize %}

<body>
  <link rel="stylesheet" href="{% static "css/selectwithImage.css" %}"  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/css/selectize.bootstrap5.min.css" integrity="sha512-Ars0BmSwpsUJnWMw+KoUKGKunT7+T8NGK0ORRKj+HT8naZzLSIQoOSIIM3oyaJljgLxFi0xImI5oZkAWEFARSA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/js/selectize.min.js"
    integrity="sha512-IOebNkvA/HZjMM7MxL0NYeLYEalloZ8ckak+NDtOViP7oiYzG5vn6WVXyrJDiJPhl4yRdmNAG49iuLmhkUdVsQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>

  <a class="previous round" 
    href="{% url 'main' %}"
    style="
      position: relative !important; 
      top: 20px !important;
      left: 20px !important;
      padding: 8px 16px;
      border-radius: 50%;
      background-color: #f1f1f1;
    "
  >
    <i class="fa-solid fa-arrow-left"></i>
  </a>

  <div class="d-flex w-100 flex-column vh-100 align-items-center mt-4">
    {% comment %}
    <div class="row w-100">
      {% endcomment %}
      <div class="mx-auto">
        <h3>Crear Venta</h3>
      </div>

      <form class="container-md" id="ventaForm" enctype="multipart/form-data">
        <div class="row"> 
        <div class="form-group col-sm-12 col-md-6 col-xl-3">
          {% comment %} Este campo de factura debe llevar {% endcomment %}
          <label for="email"># Factura</label>
          <input
            type="number"
            class="form-control"
            id="facturaVenta"
            placeholder=""
            name="factura"
            value="{{factura}}"
            {% comment %} readonly {% endcomment %}
          />
        </div>
        <div class="form-group col-sm-12 col-md-6 col-xl-3">
          <label for="cedula">cedula cliente:</label>
          {% comment %} <input
            type="text"
            class="form-control"
            id="cedula"
            placeholder="Cedula del cliente"
            name="cliente_id"
            required
          /> {% endcomment %}

          <select 
            class="form-select camposbc" 
            id="cedula" name="cliente_id" 
            required
          >
            <option value="">--</option>
            {% if mediosPago %}
              {% for cliente in clientes  %}
                <option value="{{cliente.id}}" style="background-image:url('https://copu.media/wp-content/uploads/2023/10/Logo-Nequi-1.jpg');"> 
                  
                 {{cliente.id}}</option> 
              {% endfor %}
            {% endif %}
        </select>
          
        </div>

        <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
          <label for="nombreCliente">Nombre Cliente:</label>
          <input
            type="text"
            class="form-control"
            id="nombreCliente"
            placeholder="Nombre Cliente"
            value=""
            name="nombreCliente"
          />
        </div>

        <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
          <label for="telefonocliente">Telefono:</label>
          {% comment %} <input type="tel" id="phone"> {% endcomment %}
          
          <input
            type="text"
            class="form-control telefono"
            id="telefonoCliente"
            placeholder="xxx-xxx-xxxx"
            value=""
            maxlength="17"
            name="telefonocliente"
          />
  
        </div>

        <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
          <label for="valor">Precio de venta $</label>
          <input
            type="text"
            class="form-control precio"
            id="valor"
            placeholder="$ 0"
            value="$ 0"
            name="precio"
            required
          />
          
        </div>
        <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
          <label for="valor">Abono $</label>
          <input
            type="text"
            class="form-control precio"
            id="abono"
            placeholder="$ 0"
            value="$ 0"
            name="abono"
          />
        </div>
        {% comment %} <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
          <label for="valor">Metodo de Pago</label>
          <select 
            class="form-select camposbc" 
            id="medioDePago" name="metodoPago" 
            required
          >
            <option value="">Medio de pago...</option>
            {% if mediosPago %}
              {% for medioPago in mediosPago  %}
                <option value="{{medioPago.id}}">{{medioPago.nombre}}</option> 
              {% endfor %}
            {% endif %}
        </select>
        </div> {% endcomment %}

        <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
          <label for="valor">Metodo de Pago</label>
          <div class="custom-select">
            <div class="selected form-select">
              <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRbyC6amH2B9H4vu3pEVEms33iwwLjgS1v0iw&s" alt="Default">
              <span id="valorSelect">Seleccione una opción</span>
            </div>
        
            <div class="dropdown form-select">
              {% if mediosPago %}
                {% for medioPago in mediosPago  %}
                  {% comment %} <option value="{{medioPago.id}}">{{medioPago.nombre}}</option> {% endcomment %}
                  <div class="option" data-value="{{medioPago.id}}">
                    <img src="{{medioPago.imagen}}" alt="{{medioPago.id}}">
                    {{medioPago.nombre}}
                  </div>
                {% endfor %}
              {% endif %}
            </div>
            <input type="hidden" name="metodoPago" id="metodoPago" required>
            <div class="error-message" style="display: none;">Este campo es obligatorio.</div>
          </div>
        </div>


        
        

      {% comment %} <div class="form-group col-sm-12 col-md-6 col-xl-3 col-xl-3">
        <label for="apelidoCliente">Apellido Cliente:</label>
        <input
          type="text"
          class="form-control"
          id="apellidoCliente"
          placeholder="ApellidoCliente"
          value=""
          name="apellidoCliente"
        />
      </div>
       {% endcomment %}
      
        
      <div class="form-group col-sm-12 col-md-6 col-xl-3 ">
        <label for="password">Fecha de la venta</label>
        <input
          type="date"
          class="form-control"
          id="fechaVenta"
          placeholder="Ingrese su contraseña"
          name="fecha"
          required
        />
      </div>
        
      </div>
      <div class="row"> 
        <div class="form-group col-sm-12 col-md-12 col-xl-6 ">
          <label for="detalleVenta">Detalle</label>
          <textarea
            rows="3"
            cols="50"
            class="form-control"
            id="detalleVenta"
            name="detalle"
            placeholder="Detalle"
          ></textarea>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-xl-6">
          <label for="observacionVenta">Observaciones:</label>
          <textarea
            rows="3"
            cols="50"
            class="form-control"
            id="observacionVenta"
            name="observacion"
            placeholder="Observaciones"
          ></textarea>
        </div>
      </div>
      <div class="form-group col-sm-12 col-md-6 col-xl-3 ">
        <label for="foto">Foto:</label>
        <input
          type="file"
          class="form-control"
          id="foto"
          {% comment %} placeholder="Ingrese su contraseña" {% endcomment %}
          name="foto"
          
        />
      </div>

      {% include 'components/tablaArticulos.html' %}
        <hr class="my-3" />
        <div class="row my-1">
          <div class="form-group">
            <button type="submit" class="btn btn-primary col-12" id="submitVenta">
              Crear venta
            </button>
          </div>
        </div>

        
      </form>

      

      <hr class="my-3" />
      <div class="mx-auto">
        <h3>Facturas recientes</h3>
      </div>
      <div class="table-responsive container-md">
        
        <table class="table table-striped table-hover" >
          {% comment %} style="width: 90%" table-bordered {% endcomment %}
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Factura</th>
              <th scope="col">Nombre</th>
              <th scope="col">Precio venta</th>
              <th scope="col">Abono Total</th>
              <th scope="col">Saldo</th>
              <th scope="col">Estado</th>
            </tr>
          </thead>
          <tbody>
            {% comment %} <tr>
              <th scope="row">1</th>
              <td>256</td>
              <td>Otto Montoya</td>
              <td>$ 1.120.000</td>
              <td>$ 800.000</td>
              <td>$ 320.000</td>
              <th scope="col" class="text-danger">Por pagar</th>
            </tr> {% endcomment %}
            {% if ventas %}
              {% for venta in ventas %}
                  <tr>
                    <td>{{venta.numero}}</td>
                    <th scope="row">{{venta.factura}}</th>
                    <td>{{venta.nombre}}</td>
                    <td>$ {{venta.precio|floatformat:2|intcomma }}</td>
                    <td>$ {{venta.abono|floatformat:2|intcomma }}</td>
                    <td>$ {{venta.saldo|floatformat:2|intcomma }}</td>
                    {% if venta.estado == "Pagado"  %}
                    <th scope="col" class="text-success">{{venta.estado}}</th>
                    {% else %}
                    <th scope="col" class="text-danger">{{venta.estado}}</th>
                    {% endif %}
                    
                  </tr>
              {% endfor %}
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  
  
  

  

  



  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.2.1/build/js/intlTelInput.min.js"></script>
  <script>
    const input = document.querySelector("#telefonoCliente");
    const iti = window.intlTelInput(input, {
      loadUtils: () => import("https://cdn.jsdelivr.net/npm/intl-tel-input@25.2.1/build/js/utils.js"),
      initialCountry: "co",
    });

    const parentElement = input.parentElement;
    parentElement.style.display = "block";

    // Obtener  numero del campo
    const number = iti.getNumber();


  </script>

  <script>
    const medioDePago = $('#medioDePago').selectize();
    const articulo = $('#articulo').selectize({
      maxOptions: 5,
    })
    const usuario = $('#cedula').selectize({
      create: true,
      createOnBlur: true,       // Crea el valor cuando el input pierde el foco
      sortField: null,        // Ordena las opciones por texto, pero esto se modificará dinámicamente
      persist: false, // No persiste las opciones creadas si no están seleccionadas
      allowEmptyOption: true, // Permite un campo vacío
      maxItems: 1,
      maxOptions: 10,

  
    })

    

  

    // Obetener el valor del selector con selectize
    // usuario[0].selectize.getValue()
    // $('#normalize1').selectize();


    /*document.querySelector('#telefonoCliente').addEventListener('input',async function(event) {
      let input = event.target.value;
      // Elimina cualquier carácter que no sea un número
  
      // Actualiza el valor del input con el formato adecuado
      event.target.value = phoneFormat(input);
      
  });*/
  </script>

  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="{% static 'js/selectwithImage.js' %}"></script>
  <script src="{% static 'js/utils.js' %}"></script>
  <script src="{% static 'js/ventas.js' %}"></script>
  <script src="{% static 'js/tablaArticulos.js' %}"></script>
  

  





  {% comment %} Un intento mas  {% endcomment %}

  
  

  
</body>

{% endblock container %}
